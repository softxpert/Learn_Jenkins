import groovy.json.JsonSlurper

/**
 * Parameters Section
 */
//REGION = null
//ENVIRONMENT = null
//SUB_ENVIRONMENT = null
IDENTIFIER = "${params.IDENTIFIER}".trim()
//IDENTIFIER = "TEST"


/**
 * Adds a string parameter
 *
 * @return array
 */
def getIdentifierParameter() {
    setEnvVars()
    return [$class: 'ValidatingStringParameterDefinition',
            //defaultValue: 'ed4-helloworld',
            description: """
<b>Name of Service, use dashes here if required!</b>
""" ,
            regex: '^[a-z][a-z0-9-]{5,31}$',
            name: 'IDENTIFIER'
    ]
}




/**
 * Adds a boolean parameter
 *
 * @return array
 */
def getBucketParameter() {
    return [$class: 'BooleanParameterDefinition',
            description: """
<b>Add bucket to module configuration</b>
""" ,
            name: 'BUCKET'
    ]
}


/**
 * Get all parameters as array
 *
 * @return array
 */
def getParameters() {
    return [
        getIdentifierParameter(),
        getBucketParameter()

    ]
}



/**
 * Load and set env vars
 *
 * @return
 */
def setEnvVars() {
    //load "$JENKINS_HOME/ed4.groovy"
    //REGION = "${env.AWS_REGION}"
    //ENVIRONMENT = "${env.ED4_ENV}"
    //SUB_ENVIRONMENT = "${env.SUB_ENVIRONMENT}"
    echo "In setEnvVars"
}


def generate() {
    PARAMETERS = "-i $IDENTIFIER"

    if (BUCKET.equals("true")) {
        PARAMETERS += " -b"
    }
    
    echo "${PARAMETERS}"
    
    //return [
    //    $PARAMETERS
    //]
}


node {

    properties([
        parameters(
            getParameters()
        )
    ])

    stage('build') {
        sh  'echo "Hello!"'
        generate()
        //echo $RET
    }
}
